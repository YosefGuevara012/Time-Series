---
title: "Untitled"
author: "Juan Pablo Rodriguez"
date: "26/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(lubridate)
library(vars)
library(tseries)
library(ppcor)
library(TSA)
library(forecast)
library(ggplot2)
library(urca)

```

1.	Encuentre un vector de series de tiempo multivariado con m ≥ 10. 
•	Construya el modelo de componentes principales con covarianza muestral y correlación muestral.
•	Haga un reporte de análisis, incluyendo el código.

CODIGO PROFE DE: Multivariate Time Series Analysis and Applications William W S Wei 

Cargue de base de datos

La base a continuación muestra los datos de contagios de varicela en 10 ciudades de Hungria.

```{r}
varic <- read.csv("VIRUOK.csv", header = TRUE,sep=";")
varic<-as.data.frame(varic)

```

```{r}
mvaric<-ts(varic,freq=365/7,start=decimal_date(ymd("2005-01-03")))

summary(mvaric)
plot(mvaric,  main = "Series temporales: Varicela ")
```

Ejecución de PCA

Sin corelacion:

```{r}
pca <- princomp(mvaric)
pca
pca <- princomp(mvaric,cor=F)
lds <- pca$loadings
```
```{r}
 screeplot(pca,type="lines",main="Grafico cp")

```


con Correlacion:

```{r}
pca2 <- princomp(mvaric,cor=T)
lds <- pca2$loadings
scs <- pca2$scores
screeplot(pca2,type="lines",main="screeplot")
```
Grafico Sectores por los primeros dos loadings

```{r}

              
C <- as.data.frame(cbind(lds[,1],lds[,2]))
ggplot(C,aes(C[,1],C[,2],label=rownames(C))) +
 geom_point(size=4,col=3) +
 geom_text(vjust=0,hjust=0,angle = 10,size=5) +
 xlab("Loading 1") +
 ylab("Loading 2")
              
```
Grafico  Series de tiempo por scores sobre las dos primeras 2 componentes 

```{r}
##
              C <- as.data.frame(cbind(scs[,1],scs[,2]))
              palette(rainbow(400))
              ggplot(C,aes(C[,1],C[,2],label=substring(rownames(C),1,7))) +
                geom_point(size=4,col=1:nrow(C)) +
                geom_text(vjust=0,hjust=0,angle = 10,size=5) +
                xlab("Scoring 1") +
                ylab("Scoring 2")
              palette("default")
```



2.2.	Considere los retornos mensuales del portafolio 1,2, y 5 de Enero 1961 a  Septiembre 2011. (Nombre: m-dec15678-6111.txt )

(a) Especifique un modelo VMA para el retorno 
 b)  Haga la estimación del modelo con MV. 
c)   Refine el modelo para una t mayor   1.645. 
d) Escriba el modelo ajustado
e)  Use el modelo para pronosticar los retornos
f) Obtenga los intervalos de confianza del 95%. 

Punto A.


```{r}
da=read.table("m-dec15678-6111.txt",header=T)
x=log(da[,2:6]+1)*100
rtn=cbind(x$dec5,x$dec8)
tdx=c(1:612)/12+1961
par(mfcol=c(2,1))
plot(tdx,rtn[,1],type="l", xlab="year",ylab="d5")
plot(tdx,rtn[,2],type="l",xlab="year",ylab="d8")
```
Grafico de cros corelación
```{r}
MTS::ccm(rtn) 
```

Un modelo VMA(1) es adecuado , debido a que de los graficos de cros corelacion se puede notar que hay dependencia , para el resago 1.

Modelo VMA(1)

```{r}
VMAret<-MTS::VMA(rtn,q=1)
```


Pruebas de LjungBox:


```{r}
resVMA<-VMAret$residuals
MTS::mq(resVMA,adj=4)
```

De este modelo podemos notar que si se usa un nivel de significancia del 5% obtenemos que todos a excepción de un parametro son significativos, el modelo ajustado sería igual a :



